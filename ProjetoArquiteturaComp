ORG 0000H

; Inicialização
INIT:
    MOV P1, #0xFF        ; Desliga todos os LEDs (P1 = 0xFF)
    MOV P0, #0xF0        ; Configura as colunas (P0.6, P0.5, P0.4) como saída e as linhas (P0.3 - P0.0) como entrada
    LJMP MAIN            ; Salta para o loop principal

; Loop principal
MAIN:
    ACALL CHECK_KEY      ; Chama a sub-rotina para verificar teclas pressionadas
    LJMP MAIN            ; Volta para o loop principal

; Sub-rotina para verificar teclas pressionadas
CHECK_KEY:
    ; Varredura da primeira coluna (P0.6 = 0)
    MOV A, #0xBF         ; Coloca P0.6 em 0 (ativa a primeira coluna) e mantém as outras colunas em 1
    MOV P0, A
    MOV A, P0            ; Lê as linhas (P0.3 - P0.0)
    ANL A, #0x0F         ; Isola as linhas (P0.3 - P0.0)
    CJNE A, #0x0F, COL1_CHECK ; Se houver uma linha ativa, vai para COL1_CHECK

    ; Varredura da segunda coluna (P0.5 = 0)
    MOV A, #0xDF         ; Coloca P0.5 em 0 (ativa a segunda coluna)
    MOV P0, A
    MOV A, P0
    ANL A, #0x0F
    CJNE A, #0x0F, COL2_CHECK ; Se houver uma linha ativa, vai para COL2_CHECK

    ; Varredura da terceira coluna (P0.4 = 0)
    MOV A, #0xEF         ; Coloca P0.4 em 0 (ativa a terceira coluna)
    MOV P0, A
    MOV A, P0
    ANL A, #0x0F
    CJNE A, #0x0F, COL3_CHECK ; Se houver uma linha ativa, vai para COL3_CHECK

    ; Nenhuma tecla foi pressionada
    RET                  ; Retorna ao loop principal
COL1_CHECK:
    ; Verifica qual linha foi ativada na primeira coluna
    CJNE A, #0x0E, KEY_1 ; Tecla '1'
    CJNE A, #0x0D, KEY_2 ; Tecla '2'
    CJNE A, #0x0B, KEY_3 ; Tecla '3'
    CJNE A, #0x07, KEY_STAR ; Tecla '*'
    RET

COL2_CHECK:
    ; Verifica qual linha foi ativada na segunda coluna
    CJNE A, #0x0E, KEY_4 ; Tecla '4'
    CJNE A, #0x0D, KEY_5 ; Tecla '5'
    CJNE A, #0x0B, KEY_6 ; Tecla '6'
    CJNE A, #0x07, KEY_0 ; Tecla '0'
    RET

COL3_CHECK:
    ; Verifica qual linha foi ativada na terceira coluna
    CJNE A, #0x0E, KEY_7 ; Tecla '7'
    CJNE A, #0x0D, KEY_8 ; Tecla '8'
    CJNE A, #0x0B, KEY_9 ; Tecla '9'
    CJNE A, #0x07, KEY_HASH ; Tecla '#'
    RET

; Aqui tratamos cada tecla pressionada
KEY_0:
    CLR P1.0             ; Apaga o bit P1.0 (acende o LED no pino P1.0)
    ACALL WAIT           ; Espera enquanto a tecla está pressionada
    SETB P1.0            ; Mantém o LED aceso
    RET

KEY_1:
    CLR P1.1             ; Apaga o bit P1.1 (acende o LED no pino P1.1)
    ACALL WAIT           ; Espera enquanto a tecla está pressionada
    SETB P1.1            ; Mantém o LED aceso
    RET
KEY_2:
    CLR P1.2             ; Apaga o bit P1.2 (acende o LED no pino P1.2)
    ACALL WAIT           ; Espera enquanto a tecla está pressionada
    SETB P1.2            ; Mantém o LED aceso
    RET
KEY_3:
    CLR P1.3             ; Apaga o bit P1.3 (acende o LED no pino P1.3)
    ACALL WAIT           ; Espera enquanto a tecla está pressionada
    SETB P1.3            ; Mantém o LED aceso
    RET



